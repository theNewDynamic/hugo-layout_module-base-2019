{{/* 
	Print SEO meta tags for a given page
	
	@author The New Dynamic
	
	@access public

	@context Page 

	@example - Go Template
		$seo := partial "seo/tags" .

	TODO:
		- Twitter can sport "author" handle on top of the site's. Devise a test for author? 
		- Not sure about image size. Following https://docs.imgix.com/best-practices/improving-seo-traffic, we have a 
			square of 800x800 */}}

 
{{/*------------------------------
	BUILDING SCRATCH SEO OBJECT
	------------------------------ */}}

{{- $.Scratch.Set "seo" dict -}}
{{- $.Scratch.SetInMap "seo" "title" (printf "%s | %s" .Title .Site.Title ) -}}
{{- $.Scratch.SetInMap "seo" "description" .Site.Params.Description -}}

 
{{/* Dates
	----------------------------- */}}
{{- if not .PublishDate.IsZero -}}
{{- $.Scratch.SetInMap "seo" "published_time" (.PublishDate.Format "2006-01-02T15:04:05-07:00") -}}
{{- else if not .Date.IsZero -}}
{{- $.Scratch.SetInMap "seo" "published_time" (.Date.Format "2006-01-02T15:04:05-07:00") -}}
{{- end -}}
{{- if not .Lastmod.IsZero -}}
{{- $.Scratch.SetInMap "seo" "updated_time" (.Lastmod.Format "2006-01-02T15:04:05-07:00") -}}
{{- end -}}

 
{{/* Description
	---------------------------- */}}
{{- with .Summary -}}
	{{- $.Scratch.SetInMap "seo" "description" . -}}
{{- end -}}
{{- with .Params.seo.description -}}
	{{- $.Scratch.SetInMap "seo" "description" . -}}
{{- end -}}

 
{{/* Title
	---------------------------- */}}
{{- if .IsHome -}}
	{{- $.Scratch.SetInMap "seo" "title" .Site.Title -}}
{{- end -}}

{{/* Site Name
	---------------------------- */}}
{{- with .Param "seo.site_name" -}}
	{{- $.Scratch.SetInMap "seo" "site_name" . -}}
{{- else -}}
	{{- $.Scratch.SetInMap "seo" "site_name" .Site.Title -}}
{{- end -}}

{{- $.Scratch.SetInMap "seo" "twitter_card" "summary_large_image" -}}
{{- with .Site.Social.twitter -}}
	{{- $.Scratch.SetInMap "seo" "twitter_handle" (printf "@%s" .) -}}
{{- end -}}
{{- with .Site.Params.default_image -}}
	{{- $.Scratch.SetInMap "seo" "image" (. | absURL) -}}
{{- end -}}


{{/* Image
	---------------------------- */}}
{{- $img := "/uploads/default.jpg" -}}
{{- with .Params.images -}}
	{{- with index . 0 -}}
		{{- with .image -}}
			{{- $img = . -}}
		{{- end -}}
	{{- end -}}
{{- end -}}
{{- with .Params.seo.image -}}
	{{- $img := . -}}
{{- end -}}
{{- $query := false -}}
{{- with .Site.Params.image_url -}}
	{{- $query = querify "h" "800" "w" "800" "fit" "crop" -}}
{{- end -}}
{{ if templates.Exists "partials/_components/imgx-src.html" }}
	{{ $img = partial "_components/imgx-src" (dict "src" $img "query" $query) }}
{{ end }}
{{- $.Scratch.SetInMap "seo" "image" $img -}}

{{- $.Scratch.SetInMap "seo" "type" "website" -}}



{{/* Type
	---------------------------- */}}
{{- if eq .Type "post" -}}
	{{- $.Scratch.SetInMap "seo" "type" "article" -}}
{{- end -}}


{{/* Locale
	---------------------------- */}}
{{- $.Scratch.SetInMap "seo" "locale" "en_US" -}}


 
{{/*------------------------------
	RETRIEVING PROJECT'S OWN DATA
	------------------------------ */}}
{{- partial "_components/seo/extend" . -}}

 
{{/*------------------------------
	WRITING TAGS
	------------------------------ */}}
{{- $seo := .Scratch.Get "seo" -}}

<title>{{ $seo.title }}</title>
<meta name="description" content="{{ $seo.description }}">
<meta property="og:title" content="{{ $seo.title }}">
<meta property="og:site_name" content="{{ $seo.site_name }}">
<meta property="og:description" content="{{ $seo.description }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:type" content="{{ $seo.type }}">
<meta property="og:locale" content="{{ $seo.locale }}">
<meta property="og:image" content='{{ $seo.image }}'>
{{- with ($seo.image_width) -}}
	<meta property="og:image:width" content="{{ . }}">
{{- end -}}
{{- with ($seo.image_height) -}}
	<meta property="og:image:height" content="{{ . }}">
{{- end -}}
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{- $seo.title }}">
<meta name="twitter:site" content="{{- $seo.twitter_handle }}">
<meta name="twitter:creator" content="{{- $seo.twitter_handle }}">
<meta name="twitter:description" content="{{- $seo.description }}">
<meta name="twitter:image" content="{{- $seo.image }}">
<meta property="article:published_time" content="{{- $seo.published_time }}">
{{- with $seo.updated_time }}
	<meta property="article:updated_time" content="{{- $seo.updated_time }}">
{{- end }}